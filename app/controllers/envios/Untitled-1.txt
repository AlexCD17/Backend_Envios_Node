const EasyPost = require("@easypost/api");

exports.cotizacion = (req, res) => {
  const api = new EasyPost(process.env.API_KEY_PAQ_SANDBOX);

  //ORIGEN
  const {
    de_compania,
    de_direccion1,
    de_direccion2,
    de_pais,
    de_ciudad,
    de_codigo_estado,
    de_zip,
    de_telefono
  } = req.body;
  //DESTINO
  const {
    para_compania,
    para_direccion1,
    para_direccion2,
    para_pais,
    para_ciudad,
    para_codigo_estado,
    para_zip,
    para_telefono
  } = req.body;

  //paquetes
  const { longitud, anchura, altura, peso } = req.body;

  const fromAddress = new api.Address({
    company: de_compania,
    street1: de_direccion1,
    street2: "",
    country: de_pais,
    city: de_ciudad,
    state: de_codigo_estado,
    zip: de_zip,
    phone: ""
  });

  fromAddress.save().then(console.log);

  const toAddress = new api.Address({
    company: para_compania,
    street1: para_direccion1,
    street2: "",
    country: para_pais,
    city: para_ciudad,
    state: para_codigo_estado,
    zip: para_zip,
    phone: ""
  });

  toAddress.save().then(console.log);

  const parcel = new api.Parcel({
    length: 9,
    width: 6,
    height: 2,
    weight: 10
  });

  parcel.save().then(console.log);

  const shipment = new api.Shipment({
    to_address: toAddress,
    from_address: fromAddress,
    parcel: parcel
  });

  shipment.save().then(data => {
    console.log("---------------------------------------");
    res.status(200).send({ message: data });
  });
};
