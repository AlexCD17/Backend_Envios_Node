const EasyPost = require("@easypost/api");

exports.cotizacion = (req, res) => {
  const api = new EasyPost(process.env.API_KEY_PAQ_SANDBOX);

  /*  console.log(req.body); */
  //ORIGEN
  const origen = req.body.origen;
  const destino = req.body.origen;
  const paquete_ent = req.body.paquete;

  console.log(origen);

  const origen_easypost = {
    company: origen.persona,
    street1: origen.street + " " + origen.houseNumber,
    street2: origen.street2,
    country: origen.country,
    city: origen.county,
    state: origen.state,
    zip: origen.postalCode
  };

  const destino_easypost = {
    company: destino.persona,
    street1: destino.street + " " + destino.houseNumber,
    street2: destino.street2,
    country: destino.country,
    city: destino.county,
    state: destino.state,
    zip: destino.postalCode
  };

  const paquete = {
    length: paquete_ent.longitud,
    width: paquete_ent.anchura,
    height: paquete_ent.altura,
    weight: paquete_ent.peso
  };

  /*   console.log(origen_easypost); */

  const from_address = new api.Address(origen_easypost);

  from_address.save().then(console.log);

  const to_address = new api.Address(destino_easypost);

  to_address.save().then();

  const parcel = new api.Parcel(paquete);

  parcel.save().then();

  const shipment = new api.Shipment({
    to_address,
    from_address,
    parcel
  });

  shipment.save().then(data => {
    console.log("---------------------------------------");
    res.status(200).send({ message: data });
  });
};
